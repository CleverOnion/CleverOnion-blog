# éŸ³æ•ˆç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ—ï¸ æ€»ä½“æ¶æ„

### æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ è®¾ç½®é¢æ¿ UI â”‚  â”‚ Toast ç»„ä»¶  â”‚  â”‚ å…¶ä»– UIç»„ä»¶ â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é…ç½®å±‚ (Configuration)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           SoundConfigManager                     â”‚    â”‚
â”‚  â”‚  - è¯»å–/ä¿å­˜é…ç½®                                  â”‚    â”‚
â”‚  â”‚  - é…ç½®éªŒè¯                                       â”‚    â”‚
â”‚  â”‚  - é…ç½®åˆå¹¶ï¼ˆç”¨æˆ·é…ç½® + é»˜è®¤é…ç½®ï¼‰                 â”‚    â”‚
â”‚  â”‚  - é…ç½®é¢„è®¾ç®¡ç†                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç®¡ç†å±‚ (Management)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              SoundManager                        â”‚    â”‚
â”‚  â”‚  - äº‹ä»¶è·¯ç”±                                       â”‚    â”‚
â”‚  â”‚  - æƒé™æ£€æŸ¥ï¼ˆå…¨å±€å¼€å…³ã€åˆ†ç±»å¼€å…³ï¼‰                  â”‚    â”‚
â”‚  â”‚  - èŠ‚æµæ§åˆ¶                                       â”‚    â”‚
â”‚  â”‚  - ä¼˜å…ˆçº§è°ƒåº¦                                     â”‚    â”‚
â”‚  â”‚  - ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ˆæ ‡ç­¾é¡µå¯è§æ€§ã€ç³»ç»Ÿè®¾ç½®ç­‰ï¼‰           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¼•æ“å±‚ (Engine)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              SoundEngine                         â”‚    â”‚
â”‚  â”‚  - Web Audio API å°è£…                            â”‚    â”‚
â”‚  â”‚  - éŸ³é¢‘æ–‡ä»¶åŠ è½½                                   â”‚    â”‚
â”‚  â”‚  - AudioBuffer ç¼“å­˜                              â”‚    â”‚
â”‚  â”‚  - æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/æš‚åœ/åœæ­¢ï¼‰                      â”‚    â”‚
â”‚  â”‚  - éŸ³é‡æ§åˆ¶                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  èµ„æºå±‚ (Resources)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ success.mp3â”‚  â”‚  error.mp3 â”‚  â”‚ å…¶ä»–éŸ³æ•ˆæ–‡ä»¶ â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. SoundEngineï¼ˆéŸ³æ•ˆå¼•æ“ï¼‰

**èŒè´£**ï¼šåº•å±‚éŸ³é¢‘æ’­æ”¾èƒ½åŠ›

```typescript
class SoundEngine {
  private audioContext: AudioContext;
  private bufferCache: Map<string, AudioBuffer>;
  private gainNode: GainNode;

  // åŠ è½½éŸ³é¢‘æ–‡ä»¶
  async loadSound(url: string): Promise<AudioBuffer>;

  // æ’­æ”¾éŸ³é¢‘
  async play(buffer: AudioBuffer, options: PlayOptions): Promise<void>;

  // è®¾ç½®ä¸»éŸ³é‡
  setMasterVolume(volume: number): void;

  // åœæ­¢æ‰€æœ‰éŸ³æ•ˆ
  stopAll(): void;

  // é¢„åŠ è½½éŸ³æ•ˆ
  preload(urls: string[]): Promise<void>;
}
```

**æŠ€æœ¯ç»†èŠ‚**

- ä½¿ç”¨ **Web Audio API** è€Œé `<audio>` æ ‡ç­¾
  - ä¼˜åŠ¿ï¼šä½å»¶è¿Ÿã€ç²¾ç¡®æ§åˆ¶ã€æ”¯æŒå¤šéŸ³è½¨æ··åˆ
- éŸ³é¢‘ç¼“å­˜ç­–ç•¥
  - ä½¿ç”¨ `Map<string, AudioBuffer>` ç¼“å­˜è§£ç åçš„éŸ³é¢‘
  - é¿å…é‡å¤åŠ è½½å’Œè§£ç 
- éŸ³é‡æ§åˆ¶
  - é€šè¿‡ `GainNode` å®ç°å…¨å±€éŸ³é‡
  - æ”¯æŒå•ä¸ªéŸ³æ•ˆçš„éŸ³é‡è°ƒæ•´

### 2. SoundManagerï¼ˆéŸ³æ•ˆç®¡ç†å™¨ï¼‰

**èŒè´£**ï¼šä¸šåŠ¡é€»è¾‘å’Œæ™ºèƒ½æ§åˆ¶

```typescript
class SoundManager {
  private engine: SoundEngine;
  private configManager: SoundConfigManager;
  private throttleMap: Map<string, ThrottleState>;
  private playQueue: PriorityQueue<SoundTask>;

  // æ’­æ”¾éŸ³æ•ˆï¼ˆä¸»å…¥å£ï¼‰
  play(eventName: string, options?: PlayOptions): Promise<void>;

  // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ’­æ”¾
  private shouldPlay(eventName: string, config: SoundConfig): boolean;

  // èŠ‚æµæ£€æŸ¥
  private checkThrottle(eventName: string, throttleMs: number): boolean;

  // ä¼˜å…ˆçº§è°ƒåº¦
  private schedulePlay(task: SoundTask): void;
}
```

**æ ¸å¿ƒåŠŸèƒ½**

#### 2.1 æƒé™æ£€æŸ¥

```typescript
shouldPlay(eventName: string, config: SoundConfig): boolean {
  // 1. æ£€æŸ¥å…¨å±€å¼€å…³
  if (!config.master.enabled) return false;

  // 2. æ£€æŸ¥åˆ†ç±»å¼€å…³
  const category = this.getCategory(eventName);
  if (!config.categories[category]?.enabled) return false;

  // 3. æ£€æŸ¥å…·ä½“åœºæ™¯å¼€å…³
  if (!config.categories[category]?.scenes[eventName]?.enabled) {
    return false;
  }

  // 4. æ£€æŸ¥ä¸Šä¸‹æ–‡
  if (!this.checkContext()) return false;

  return true;
}
```

#### 2.2 èŠ‚æµæœºåˆ¶

```typescript
interface ThrottleState {
  lastPlayTime: number;
  playCount: number;
  windowStart: number;
}

checkThrottle(eventName: string, throttleMs: number): boolean {
  const now = Date.now();
  const state = this.throttleMap.get(eventName);

  if (!state || now - state.lastPlayTime > throttleMs) {
    this.throttleMap.set(eventName, {
      lastPlayTime: now,
      playCount: 1,
      windowStart: now
    });
    return true;
  }

  return false; // è¢«èŠ‚æµ
}
```

**èŠ‚æµç­–ç•¥**

- **æ—¶é—´èŠ‚æµ**ï¼šç›¸åŒäº‹ä»¶åœ¨ N æ¯«ç§’å†…åªæ’­æ”¾ä¸€æ¬¡
- **é¢‘ç‡é™åˆ¶**ï¼šæ»‘åŠ¨çª—å£å†…æœ€å¤šæ’­æ”¾ M æ¬¡
- **å»é‡**ï¼šå¿«é€Ÿè¿ç»­çš„ç›¸åŒäº‹ä»¶åªæ’­æ”¾ä¸€æ¬¡

#### 2.3 ä¼˜å…ˆçº§ç³»ç»Ÿ

```typescript
enum SoundPriority {
  Low = 0,
  Normal = 1,
  High = 2,
  Critical = 3,
}

interface SoundTask {
  eventName: string;
  priority: SoundPriority;
  timestamp: number;
  options?: PlayOptions;
}

// ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆæœ€å¤§å †ï¼‰
class PriorityQueue<T> {
  // é«˜ä¼˜å…ˆçº§å…ˆå‡ºé˜Ÿ
  // åŒä¼˜å…ˆçº§æŒ‰æ—¶é—´æˆ³ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰
}
```

**ä¼˜å…ˆçº§è§„åˆ™**

- Criticalï¼šç«‹å³æ’­æ”¾ï¼Œå¯æ‰“æ–­ä½ä¼˜å…ˆçº§
- Highï¼šä¼˜å…ˆæ’­æ”¾
- Normalï¼šæ­£å¸¸æ’é˜Ÿ
- Lowï¼šå¯è¢«è·³è¿‡

#### 2.4 ä¸Šä¸‹æ–‡æ„ŸçŸ¥

```typescript
checkContext(): boolean {
  // 1. æ£€æŸ¥æ ‡ç­¾é¡µå¯è§æ€§
  if (document.hidden) return false;

  // 2. æ£€æŸ¥ç³»ç»Ÿè®¾ç½®ï¼ˆå‡å°‘åŠ¨æ•ˆï¼‰
  if (this.respectReducedMotion()) {
    const prefersReduced = window.matchMedia(
      '(prefers-reduced-motion: reduce)'
    ).matches;
    if (prefersReduced) return false;
  }

  // 3. æ£€æŸ¥ç”¨æˆ·è¾“å…¥çŠ¶æ€
  if (this.isUserTyping()) return false;

  return true;
}
```

### 3. SoundConfigManagerï¼ˆé…ç½®ç®¡ç†å™¨ï¼‰

**èŒè´£**ï¼šé…ç½®çš„æŒä¹…åŒ–å’Œç®¡ç†

```typescript
class SoundConfigManager {
  private static STORAGE_KEY = "sound-system-config";
  private config: SoundConfig;
  private defaultConfig: SoundConfig;

  // åŠ è½½é…ç½®
  load(): SoundConfig;

  // ä¿å­˜é…ç½®
  save(config: SoundConfig): void;

  // é‡ç½®ä¸ºé»˜è®¤é…ç½®
  reset(): void;

  // å¯¼å‡ºé…ç½®ï¼ˆJSONï¼‰
  export(): string;

  // å¯¼å…¥é…ç½®
  import(json: string): void;

  // è·å–é¢„è®¾é…ç½®
  getPreset(name: PresetName): SoundConfig;
}
```

**é…ç½®æ•°æ®ç»“æ„**

```typescript
interface SoundConfig {
  version: string;

  master: {
    enabled: boolean;
    volume: number; // 0-100
    respectSystemSettings: boolean;
  };

  categories: {
    [category: string]: CategoryConfig;
  };
}

interface CategoryConfig {
  enabled: boolean;
  volume: number; // 0-100ï¼ˆç›¸å¯¹äºä¸»éŸ³é‡ï¼‰
  throttle: number; // æ¯«ç§’

  scenes: {
    [eventName: string]: SceneConfig;
  };
}

interface SceneConfig {
  enabled: boolean;
  volume?: number; // å¯é€‰ï¼Œè¦†ç›–åˆ†ç±»éŸ³é‡
  priority?: SoundPriority;
  soundFile?: string; // è‡ªå®šä¹‰éŸ³æ•ˆæ–‡ä»¶
}
```

**å­˜å‚¨ç­–ç•¥**

- **LocalStorage**ï¼šä¸»è¦å­˜å‚¨æ–¹å¼
  - ä¼˜ç‚¹ï¼šæŒä¹…åŒ–ã€å®¹é‡å¤Ÿç”¨ï¼ˆ5-10MBï¼‰
  - ç¼ºç‚¹ï¼šåŒæ­¥ APIï¼ˆä½†é…ç½®æ•°æ®å°ï¼Œå½±å“å¯å¿½ç•¥ï¼‰
- **SessionStorage**ï¼šä¼šè¯çº§ä¸´æ—¶é…ç½®ï¼ˆæœªæ¥æ‰©å±•ï¼‰
- **IndexedDB**ï¼šè‡ªå®šä¹‰éŸ³æ•ˆæ–‡ä»¶å­˜å‚¨ï¼ˆæœªæ¥æ‰©å±•ï¼‰

**é…ç½®åˆå¹¶ç­–ç•¥**

```typescript
load(): SoundConfig {
  const stored = localStorage.getItem(STORAGE_KEY);
  const userConfig = stored ? JSON.parse(stored) : {};

  // æ·±åº¦åˆå¹¶ï¼šç”¨æˆ·é…ç½®è¦†ç›–é»˜è®¤é…ç½®
  return deepMerge(this.defaultConfig, userConfig);
}
```

---

## ğŸµ éŸ³æ•ˆåˆ†ç±»ä½“ç³»

### å½“å‰å®ç°ï¼ˆPhase 1ï¼‰

```
API éŸ³æ•ˆï¼ˆapiï¼‰
â”œâ”€â”€ æˆåŠŸéŸ³æ•ˆï¼ˆapi.successï¼‰
â”‚   â”œâ”€â”€ api.success.get      [ä¼˜å…ˆçº§: Low]
â”‚   â”œâ”€â”€ api.success.post     [ä¼˜å…ˆçº§: Normal]
â”‚   â”œâ”€â”€ api.success.put      [ä¼˜å…ˆçº§: Normal]
â”‚   â””â”€â”€ api.success.delete   [ä¼˜å…ˆçº§: High]
â””â”€â”€ é”™è¯¯éŸ³æ•ˆï¼ˆapi.errorï¼‰
    â”œâ”€â”€ api.error.4xx        [ä¼˜å…ˆçº§: High]
    â”œâ”€â”€ api.error.401        [ä¼˜å…ˆçº§: High]
    â”œâ”€â”€ api.error.403        [ä¼˜å…ˆçº§: High]
    â”œâ”€â”€ api.error.404        [ä¼˜å…ˆçº§: Normal]
    â””â”€â”€ api.error.5xx        [ä¼˜å…ˆçº§: Critical]
```

### æ‰©å±•è®¾è®¡ï¼ˆPhase 2+ï¼‰

```
UI äº¤äº’éŸ³æ•ˆï¼ˆinteractionï¼‰
â”œâ”€â”€ interaction.click.button
â”œâ”€â”€ interaction.toggle.switch
â”œâ”€â”€ interaction.expand.panel
â””â”€â”€ interaction.drag.start

å†…å®¹æ“ä½œéŸ³æ•ˆï¼ˆcontentï¼‰
â”œâ”€â”€ content.publish.article
â”œâ”€â”€ content.save.draft
â”œâ”€â”€ content.delete.confirm
â””â”€â”€ content.upload.success

é€šçŸ¥éŸ³æ•ˆï¼ˆnotificationï¼‰
â”œâ”€â”€ notification.message.new
â”œâ”€â”€ notification.comment.new
â””â”€â”€ notification.system.alert
```

**å‘½åè§„èŒƒ**

```
<category>.<action>.<detail>

ç¤ºä¾‹ï¼š
- api.success.post       (API æˆåŠŸï¼ŒPOST è¯·æ±‚)
- api.error.500          (API é”™è¯¯ï¼Œ500 çŠ¶æ€ç )
- interaction.click.button (äº¤äº’ï¼Œç‚¹å‡»æŒ‰é’®)
- content.publish.article  (å†…å®¹ï¼Œå‘å¸ƒæ–‡ç« )
```

---

## ğŸ”Œ é›†æˆæ–¹å¼

### 1. API æ‹¦æˆªå™¨é›†æˆ

```typescript
// src/api/index.ts
import { soundManager } from "@/utils/sound";

apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    const { code } = response.data;
    const method = response.config.method?.toUpperCase();

    // åŠ¨æ€æ„å»ºäº‹ä»¶å
    const eventName = `api.success.${method.toLowerCase()}`;
    soundManager.play(eventName);

    return response;
  },
  (error: AxiosError) => {
    const status = error.response?.status;
    const eventName = `api.error.${status || "5xx"}`;
    soundManager.play(eventName, { priority: "high" });

    return Promise.reject(error);
  }
);
```

### 2. React Hook é›†æˆ

```typescript
// æœªæ¥æ‰©å±•ï¼šUI äº¤äº’éŸ³æ•ˆ
import { useSoundEffect } from "@/hooks/useSoundEffect";

function Button() {
  const playSound = useSoundEffect();

  const handleClick = () => {
    playSound("interaction.click.button");
    // ä¸šåŠ¡é€»è¾‘...
  };

  return <button onClick={handleClick}>Click Me</button>;
}
```

### 3. äº‹ä»¶æ€»çº¿é›†æˆ

```typescript
// æœªæ¥æ‰©å±•ï¼šç³»ç»Ÿçº§äº‹ä»¶
eventBus.on("article.published", () => {
  soundManager.play("content.publish.article", {
    priority: "high",
    volume: 0.8,
  });
});
```

---

## ğŸ¨ é»˜è®¤é…ç½®

### é…ç½®é¢„è®¾

#### 1. é™éŸ³æ¨¡å¼ï¼ˆSilentï¼‰

```typescript
{
  master: { enabled: false, volume: 0 }
}
```

#### 2. ä»…é”™è¯¯æç¤ºï¼ˆErrors Onlyï¼‰

```typescript
{
  master: { enabled: true, volume: 70 },
  categories: {
    api: {
      enabled: true,
      scenes: {
        'api.success.*': { enabled: false },
        'api.error.*': { enabled: true }
      }
    }
  }
}
```

#### 3. æç®€æ¨¡å¼ï¼ˆMinimalï¼‰

```typescript
{
  master: { enabled: true, volume: 50 },
  categories: {
    api: {
      enabled: true,
      throttle: 2000, // 2ç§’èŠ‚æµ
      scenes: {
        'api.success.get': { enabled: false },
        'api.success.post': { enabled: true },
        'api.error.*': { enabled: true }
      }
    }
  }
}
```

#### 4. æ ‡å‡†æ¨¡å¼ï¼ˆStandardï¼‰- é»˜è®¤

```typescript
{
  master: {
    enabled: true,
    volume: 70,
    respectSystemSettings: true
  },
  categories: {
    api: {
      enabled: true,
      volume: 50,
      throttle: 1000,
      scenes: {
        'api.success.get': { enabled: false, priority: 'low' },
        'api.success.post': { enabled: true, priority: 'normal' },
        'api.success.put': { enabled: true, priority: 'normal' },
        'api.success.delete': { enabled: true, priority: 'high' },
        'api.error.4xx': { enabled: true, priority: 'high' },
        'api.error.5xx': { enabled: true, priority: 'critical' }
      }
    }
  }
}
```

#### 5. å®Œæ•´ä½“éªŒï¼ˆFull Experienceï¼‰

```typescript
{
  master: { enabled: true, volume: 80 },
  categories: {
    api: {
      enabled: true,
      volume: 70,
      throttle: 500,
      scenes: {
        // æ‰€æœ‰åœºæ™¯å¯ç”¨
      }
    }
  }
}
```

---

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. Web Audio API ä½¿ç”¨

```typescript
class SoundEngine {
  private audioContext: AudioContext;

  constructor() {
    // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
    this.audioContext = new (window.AudioContext ||
      (window as any).webkitAudioContext)();

    // åˆ›å»ºä¸»å¢ç›ŠèŠ‚ç‚¹ï¼ˆéŸ³é‡æ§åˆ¶ï¼‰
    this.gainNode = this.audioContext.createGain();
    this.gainNode.connect(this.audioContext.destination);
  }

  async loadSound(url: string): Promise<AudioBuffer> {
    const response = await fetch(url);
    const arrayBuffer = await response.arrayBuffer();
    return await this.audioContext.decodeAudioData(arrayBuffer);
  }

  async play(buffer: AudioBuffer, volume: number = 1.0): Promise<void> {
    const source = this.audioContext.createBufferSource();
    source.buffer = buffer;

    // åˆ›å»ºéŸ³é‡èŠ‚ç‚¹
    const gainNode = this.audioContext.createGain();
    gainNode.gain.value = volume;

    // è¿æ¥éŸ³é¢‘å›¾
    source.connect(gainNode);
    gainNode.connect(this.gainNode);

    // æ’­æ”¾
    source.start(0);
  }
}
```

**ä¼˜åŠ¿**

- ä½å»¶è¿Ÿï¼ˆ<10msï¼‰
- æ”¯æŒå¤šéŸ³è½¨åŒæ—¶æ’­æ”¾
- ç²¾ç¡®çš„éŸ³é‡æ§åˆ¶
- æ›´å¥½çš„æ€§èƒ½

### 2. æ€§èƒ½ä¼˜åŒ–

**éŸ³æ•ˆæ–‡ä»¶ä¼˜åŒ–**

- æ ¼å¼ï¼šMP3ï¼ˆå…¼å®¹æ€§å¥½ï¼‰
- å¤§å°ï¼š< 20KB
- é‡‡æ ·ç‡ï¼š44.1kHz
- æ¯”ç‰¹ç‡ï¼š128kbps
- æ—¶é•¿ï¼š< 1 ç§’

**åŠ è½½ç­–ç•¥**

```typescript
// åº”ç”¨å¯åŠ¨æ—¶é¢„åŠ è½½é«˜é¢‘éŸ³æ•ˆ
preload([
  "/assets/sounds/api/error-critical.mp3",
  "/assets/sounds/api/success.mp3",
]);

// ä½é¢‘éŸ³æ•ˆæ‡’åŠ è½½
lazyLoad("/assets/sounds/api/success-heavy.mp3");
```

**å†…å­˜ç®¡ç†**

- ä½¿ç”¨ `Map` ç¼“å­˜ `AudioBuffer`
- å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„ç¼“å­˜
- ç›‘æ§å†…å­˜å ç”¨

### 3. å¯è®¿é—®æ€§

```typescript
// å°Šé‡ç³»ç»Ÿè®¾ç½®
const prefersReducedMotion = window.matchMedia(
  "(prefers-reduced-motion: reduce)"
).matches;

if (prefersReducedMotion && config.master.respectSystemSettings) {
  // é™ä½éŸ³æ•ˆæ’­æ”¾é¢‘ç‡æˆ–å®Œå…¨ç¦ç”¨
}
```

---

## ğŸ“Š æ•°æ®æµå›¾

```
ç”¨æˆ·æ“ä½œ â†’ API è¯·æ±‚
            â†“
    API å“åº”æ‹¦æˆªå™¨
            â†“
  soundManager.play('api.success.post')
            â†“
    [æƒé™æ£€æŸ¥] â†’ å…¨å±€å¼€å…³? åˆ†ç±»å¼€å…³? åœºæ™¯å¼€å…³?
            â†“
    [èŠ‚æµæ£€æŸ¥] â†’ è·ç¦»ä¸Šæ¬¡æ’­æ”¾æ—¶é—´?
            â†“
    [ä¸Šä¸‹æ–‡æ£€æŸ¥] â†’ æ ‡ç­¾é¡µå¯è§? ç³»ç»Ÿè®¾ç½®?
            â†“
    [ä¼˜å…ˆçº§è°ƒåº¦] â†’ åŠ å…¥æ’­æ”¾é˜Ÿåˆ—
            â†“
       SoundEngine
            â†“
    [ç¼“å­˜æ£€æŸ¥] â†’ AudioBuffer å·²ç¼“å­˜?
            â†“
       æ’­æ”¾éŸ³æ•ˆ
            â†“
       ç”¨æˆ·å¬åˆ°
```

---

## ğŸ”® æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ æ–°éŸ³æ•ˆç±»å‹

**1. æ³¨å†ŒéŸ³æ•ˆæ–‡ä»¶**

```typescript
// src/utils/sound/registry.ts
export const SOUND_REGISTRY = {
  api: {
    success: "/assets/sounds/api/success.mp3",
    error: "/assets/sounds/api/error.mp3",
  },
  // æ–°å¢ï¼šUI äº¤äº’éŸ³æ•ˆ
  interaction: {
    click: "/assets/sounds/ui/click.mp3",
    toggle: "/assets/sounds/ui/toggle.mp3",
  },
};
```

**2. æ·»åŠ é»˜è®¤é…ç½®**

```typescript
// src/utils/sound/config.ts
const DEFAULT_CONFIG = {
  categories: {
    api: { ... },
    // æ–°å¢
    interaction: {
      enabled: true,
      volume: 30,
      throttle: 100,
      scenes: {
        'interaction.click': { enabled: true }
      }
    }
  }
};
```

**3. åœ¨è®¾ç½® UI ä¸­æ·»åŠ é…ç½®é¡¹**

```typescript
<SettingCategory name="interaction" label="UI äº¤äº’éŸ³æ•ˆ">
  <SettingScene name="interaction.click" label="æŒ‰é’®ç‚¹å‡»" />
</SettingCategory>
```

**4. åœ¨éœ€è¦çš„åœ°æ–¹è°ƒç”¨**

```typescript
soundManager.play("interaction.click");
```

**æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼** ğŸ‰

---

## ğŸ“ æ€»ç»“

### è®¾è®¡ä¼˜åŠ¿

1. **åˆ†å±‚æ¸…æ™°**ï¼šå¼•æ“ã€ç®¡ç†ã€é…ç½®å„å¸å…¶èŒ
2. **é«˜æ‰©å±•æ€§**ï¼šæ–°å¢éŸ³æ•ˆç±»å‹æ— éœ€ä¿®æ”¹æ ¸å¿ƒ
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šèŠ‚æµã€ç¼“å­˜ã€æ™ºèƒ½è°ƒåº¦
4. **ç”¨æˆ·å‹å¥½**ï¼šç»†ç²’åº¦æ§åˆ¶ã€æœ¬åœ°å­˜å‚¨
5. **å¼€å‘å‹å¥½**ï¼šç®€æ´ APIã€æ˜“äºé›†æˆ

### æŠ€æœ¯äº®ç‚¹

- âœ… Web Audio API ä½å»¶è¿Ÿæ’­æ”¾
- âœ… æ™ºèƒ½èŠ‚æµé˜²æ­¢è¿‡åº¦æ’­æ”¾
- âœ… ä¼˜å…ˆçº§ç³»ç»Ÿä¿è¯é‡è¦æç¤º
- âœ… ä¸Šä¸‹æ–‡æ„ŸçŸ¥æå‡ç”¨æˆ·ä½“éªŒ
- âœ… å®Œå…¨æœ¬åœ°åŒ–çš„é…ç½®å­˜å‚¨

### æ‰©å±•è·¯å¾„

```
Phase 1: API éŸ³æ•ˆï¼ˆå½“å‰ï¼‰
    â†“
Phase 2: UI äº¤äº’éŸ³æ•ˆ
    â†“
Phase 3: è‡ªå®šä¹‰éŸ³æ•ˆä¸Šä¼ 
    â†“
Phase 4: éŸ³æ•ˆä¸»é¢˜åŒ…
```

---

**ä¸‹ä¸€æ­¥**: æŸ¥çœ‹ [API å‚è€ƒæ–‡æ¡£](./api-reference.md) äº†è§£å¦‚ä½•ä½¿ç”¨
