# Markdown 文件导入功能

## 📋 功能概述

文章编辑器现在支持直接导入 Markdown 文件（`.md` 或 `.markdown`），快速创建或更新文章内容。

## ✨ 功能特性

- ✅ **文件类型验证**：仅支持 `.md` 和 `.markdown` 文件
- ✅ **智能标题提取**：自动识别并提取 Markdown 中的一级标题作为文章标题
- ✅ **内容替换警告**：当编辑器已有内容时，会显示确认对话框
- ✅ **UTF-8 编码支持**：正确处理中文和特殊字符
- ✅ **文件信息展示**：显示文件名和大小供确认

## 🎯 使用方法

### 1. 找到导入按钮

在文章编辑器顶部工具栏中，找到"导入 MD"按钮（上传图标）：

```
[返回] [文章标题输入框] [导入 MD] [快捷键帮助] [保存草稿] [发布文章]
                           ^^^^^^^^
```

### 2. 选择文件

点击"导入 MD"按钮，会打开文件选择对话框：

- 仅显示 `.md` 和 `.markdown` 文件
- 选择你要导入的 Markdown 文件

### 3. 确认导入

#### 情况 A：编辑器为空

- 文件会直接导入
- 标题和内容自动填充
- 显示成功提示

#### 情况 B：编辑器已有内容

- 显示确认对话框
- 展示警告信息：**"导入将替换所有现有内容"**
- 显示文件信息（文件名、大小）
- 选择"确认替换"或"取消"

### 4. 导入完成

- ✅ 标题栏显示提取的标题
- ✅ 编辑器显示文章内容
- ✅ 支持 LaTeX 公式等所有 Markdown 语法
- ✅ 显示成功通知

## 📝 Markdown 文件格式建议

### 推荐格式

```markdown
# 文章标题

这里是文章的正文内容...

## 小节标题

小节内容...

### 子标题

更多内容...
```

### 标题提取规则

1. **有一级标题**：提取第一个 `# 标题` 作为文章标题，其余内容作为正文
2. **无一级标题**：使用文件名（去除扩展名）作为标题，全部内容作为正文

### 示例

#### 示例 1：标准格式

**文件：`我的技术文章.md`**

```markdown
# 深入理解 React Hooks

React Hooks 是 React 16.8 引入的新特性...

## useState 的使用

useState 是最基础的 Hook...
```

**导入结果**：

- 标题：`深入理解 React Hooks`
- 内容：从 `React Hooks 是...` 开始

#### 示例 2：无标题格式

**文件：`技术笔记.md`**

```markdown
这是一些技术笔记...

代码示例：
\`\`\`javascript
console.log('Hello');
\`\`\`
```

**导入结果**：

- 标题：`技术笔记`（使用文件名）
- 内容：全部内容

## 🔔 注意事项

### ⚠️ 重要提示

1. **内容会被完全替换**

   - 导入操作会替换标题和正文的所有内容
   - 此操作无法撤销
   - 建议先保存当前内容

2. **分类和标签不受影响**

   - 导入仅影响标题和正文
   - 右侧的分类、标签、摘要等设置保持不变

3. **编码支持**

   - 文件应使用 UTF-8 编码
   - 如果文件显示乱码，请检查文件编码

4. **文件大小**
   - 建议文件大小在 5MB 以内
   - 过大的文件可能影响性能

### ✅ 最佳实践

1. **准备好的 Markdown 文件**

   - 使用标准 Markdown 语法
   - 确保文件编码为 UTF-8
   - 预览确认格式正确

2. **导入前检查**

   - 确认当前编辑器内容已保存（如需要）
   - 确认选择的是正确的文件

3. **导入后验证**

   - 检查标题是否正确
   - 预览内容格式是否符合预期
   - 验证公式、代码块等特殊内容

4. **保存工作**
   - 导入后记得保存草稿或发布
   - 导入操作不会自动保存

## 🎨 支持的 Markdown 语法

导入的文件支持所有编辑器功能：

### 基础语法

- 标题（`#` - `######`）
- 粗体（`**text**`）
- 斜体（`*text*`）
- 列表（有序、无序）
- 链接（`[text](url)`）
- 图片（`![alt](url)`）
- 引用（`> text`）

### 高级语法

- 代码块（` ``` ` 语法）
- 表格
- 任务列表
- LaTeX 数学公式（`$...$` 和 `$$...$$`）

### 示例文件

```markdown
# 完整功能演示

## 基础文本

这是**粗体**和*斜体*。

## 代码块

\`\`\`javascript
function hello() {
console.log('Hello, World!');
}
\`\`\`

## 数学公式

质能方程：$E = mc^2$

复杂公式：

$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

## 列表

1. 第一项
2. 第二项
   - 子项 A
   - 子项 B

## 表格

| 列 1 | 列 2 | 列 3 |
| ---- | ---- | ---- |
| A    | B    | C    |
| 1    | 2    | 3    |
```

## 🐛 故障排查

### 问题：文件无法选择

**原因**：文件类型不正确

**解决**：

- 确保文件扩展名是 `.md` 或 `.markdown`
- 不支持 `.txt`、`.doc` 等其他格式

### 问题：中文显示乱码

**原因**：文件编码不是 UTF-8

**解决**：

- 使用文本编辑器另存为 UTF-8 编码
- 推荐使用 VS Code 等现代编辑器

### 问题：导入后格式错乱

**原因**：Markdown 语法问题

**解决**：

- 检查 Markdown 语法是否正确
- 在 Markdown 编辑器中预览后再导入
- 查看 [Markdown 语法指南](https://www.markdownguide.org/)

### 问题：标题没有正确提取

**原因**：标题格式不标准

**解决**：

- 确保使用 `# 标题` 格式（`#` 后有空格）
- 标题应在文件开头
- 或手动在导入后修改标题

## 🔧 技术实现

### 组件架构

```
EditorToolbar
  └── MarkdownImporter
        ├── 文件选择 (input[type=file])
        ├── 文件读取 (FileReader API)
        └── 确认对话框 (Modal)

ArticleEditor
  └── handleImportMarkdown()
        ├── 标题提取
        ├── 内容处理
        └── 状态更新
```

### 关键代码

**文件读取**：

```typescript
const reader = new FileReader();
reader.readAsText(file, "UTF-8");
```

**标题提取**：

```typescript
const titleMatch = content.match(/^#\s+(.+)$/m);
if (titleMatch) {
  title = titleMatch[1].trim();
  content = content.replace(/^#\s+.+\n?/m, "").trim();
}
```

## 📚 相关文档

- [编辑器功能说明](./optimization.md)
- [Markdown 语法指南](https://www.markdownguide.org/)
- [LaTeX 公式支持](../latex-support/README.md)

## 🎓 使用场景

### 场景 1：从其他平台迁移文章

1. 从原平台导出 Markdown 文件
2. 在编辑器中点击"导入 MD"
3. 选择导出的文件
4. 调整分类和标签
5. 发布文章

### 场景 2：离线编写文章

1. 使用本地 Markdown 编辑器写作
2. 完成后导入到系统
3. 预览效果
4. 发布或保存草稿

### 场景 3：批量内容导入

1. 准备多个 Markdown 文件
2. 逐个创建新文章并导入
3. 设置相应的分类和标签
4. 批量发布

---

**功能版本**：v1.0.0  
**最后更新**：2025-10-10  
**维护者**：前端开发团队
