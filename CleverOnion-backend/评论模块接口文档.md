# 评论模块接口文档

## 概述

评论模块提供了博客文章的评论功能，支持层级回复。用户可以对文章发表评论，也可以回复其他用户的评论，形成层级结构。

## 基础信息

- **基础路径**: `/comments`
- **认证方式**: Sa-Token（部分接口需要登录）
- **数据格式**: JSON
- **字符编码**: UTF-8

## 接口列表

### 1. 发表评论

**接口描述**: 用户发表新评论或回复已有评论

- **URL**: `POST /comments`
- **认证**: 需要登录
- **Content-Type**: `application/json`

#### 请求参数

```json
{
  "content": "评论内容",
  "article_id": "文章ID",
  "user_id": 用户ID,
  "parent_id": "父评论ID（可选）"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| content | String | 是 | 评论内容，不能为空，最大1000字符 |
| article_id | String | 是 | 文章ID，不能为空 |
| user_id | Long | 是 | 用户ID，不能为空 |
| parent_id | String | 否 | 父评论ID，用于回复评论，为空表示顶级评论 |

#### 响应示例

**成功响应 (200)**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": "1",
    "content": "这是一条评论",
    "article_id": "123",
    "user_id": 456,
    "parent_id": null,
    "is_top_level": true,
    "published_at": "2024-01-15 10:30:00"
  },
  "timestamp": "2024-01-15T10:30:00"
}
```

**错误响应**:
- `400 Bad Request`: 请求参数错误
- `401 Unauthorized`: 未登录
- `500 Internal Server Error`: 服务器内部错误

### 2. 删除评论

**接口描述**: 删除指定的评论（仅评论作者可删除）

- **URL**: `DELETE /comments/{commentId}`
- **认证**: 需要登录

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| commentId | Long | 是 | 评论ID |

#### 响应示例

**成功响应 (200)**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null,
  "timestamp": "2024-01-15T10:30:00"
}
```

**错误响应**:
- `400 Bad Request`: 评论不存在或无权限删除
- `401 Unauthorized`: 未登录
- `403 Forbidden`: 无权限删除该评论
- `404 Not Found`: 评论不存在
- `500 Internal Server Error`: 服务器内部错误

### 3. 查询文章评论列表

**接口描述**: 分页查询指定文章的评论列表

- **URL**: `GET /comments`
- **认证**: 不需要登录（公开接口）

#### 查询参数

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| articleId | Long | 是 | - | 文章ID |
| page | Integer | 否 | 0 | 页码，从0开始 |
| size | Integer | 否 | 10 | 每页大小 |

#### 响应示例

**成功响应 (200)**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "comments": [
      {
        "id": "1",
        "content": "这是一条顶级评论",
        "article_id": "123",
        "user_id": 456,
        "parent_id": null,
        "is_top_level": true,
        "published_at": "2024-01-15 10:30:00"
      },
      {
        "id": "2",
        "content": "这是一条回复评论",
        "article_id": "123",
        "user_id": 789,
        "parent_id": "1",
        "is_top_level": false,
        "published_at": "2024-01-15 11:00:00"
      }
    ],
    "total_count": 25,
    "page": 0,
    "size": 10,
    "has_next": true,
    "has_previous": false
  },
  "timestamp": "2024-01-15T10:30:00"
}
```

**错误响应**:
- `400 Bad Request`: 请求参数错误
- `500 Internal Server Error`: 服务器内部错误

## 数据模型

### CommentResponse（评论响应）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | String | 评论ID |
| content | String | 评论内容 |
| article_id | String | 文章ID |
| user_id | Long | 用户ID |
| parent_id | String | 父评论ID，null表示顶级评论 |
| is_top_level | Boolean | 是否为顶级评论 |
| published_at | String | 发布时间，格式：yyyy-MM-dd HH:mm:ss |

### CommentListResponse（评论列表响应）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| comments | Array<CommentResponse> | 评论列表 |
| total_count | Long | 总评论数 |
| page | Integer | 当前页码 |
| size | Integer | 每页大小 |
| has_next | Boolean | 是否有下一页 |
| has_previous | Boolean | 是否有上一页 |

### CreateCommentRequest（创建评论请求）

| 字段名 | 类型 | 必填 | 验证规则 | 说明 |
|--------|------|------|----------|------|
| content | String | 是 | @NotBlank, @Size(max=1000) | 评论内容 |
| article_id | String | 是 | @NotBlank | 文章ID |
| user_id | Long | 是 | @NotNull | 用户ID |
| parent_id | String | 否 | - | 父评论ID |

## 业务规则

### 评论层级
- 支持两级评论结构：顶级评论和回复评论
- 顶级评论：`parent_id` 为 `null`
- 回复评论：`parent_id` 指向被回复的评论ID

### 权限控制
- 发表评论：需要登录
- 删除评论：仅评论作者可删除自己的评论
- 查看评论：公开，无需登录

### 删除规则
- 删除评论时，会递归删除所有子评论
- 删除操作不可恢复

### 数据验证
- 评论内容不能为空，最大长度1000字符
- 文章ID和用户ID必须有效
- 回复评论时，父评论必须存在

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 401 | 未登录 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 使用示例

### 发表顶级评论

```bash
curl -X POST "http://localhost:8080/comments" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-token" \
  -d '{
    "content": "这篇文章写得很好！",
    "article_id": "123",
    "user_id": 456
  }'
```

### 回复评论

```bash
curl -X POST "http://localhost:8080/comments" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-token" \
  -d '{
    "content": "我也这么认为！",
    "article_id": "123",
    "user_id": 789,
    "parent_id": "1"
  }'
```

### 查询评论列表

```bash
curl -X GET "http://localhost:8080/comments?articleId=123&page=0&size=10"
```

### 删除评论

```bash
curl -X DELETE "http://localhost:8080/comments/1" \
  -H "Authorization: Bearer your-token"
```

## 注意事项

1. **认证**: 发表和删除评论需要用户登录，查看评论无需登录
2. **权限**: 用户只能删除自己发表的评论
3. **层级**: 目前支持两级评论结构，不支持更深层级的嵌套
4. **级联删除**: 删除评论会同时删除所有子评论
5. **数据格式**: 所有时间字段使用 `yyyy-MM-dd HH:mm:ss` 格式
6. **分页**: 评论列表支持分页，页码从0开始
7. **内容限制**: 评论内容最大长度为1000字符

## 更新日志

- **v1.0.0** (2024-01-15): 初始版本，支持基本的评论功能
  - 发表评论
  - 删除评论
  - 查询评论列表
  - 支持层级回复