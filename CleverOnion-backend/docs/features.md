# CleverOnion 博客系统功能说明

## 1. 系统概述

CleverOnion 是一个基于 Spring Boot 和 DDD（领域驱动设计）架构的现代化博客系统。系统采用前后端分离的架构模式，后端提供 RESTful API 接口，支持 GitHub OAuth2 认证，具备完整的博客内容管理功能。

### 1.1 核心特性

- **现代化架构**: 基于 DDD 分层架构，代码结构清晰，易于维护和扩展
- **OAuth2 认证**: 支持 GitHub OAuth2 登录，无需传统的用户名密码注册
- **内容管理**: 完整的文章、分类、标签、评论管理功能
- **权限控制**: 基于 Sa-Token 的认证授权体系，支持管理员权限
- **API 优先**: RESTful API 设计，支持前后端分离
- **数据安全**: 完善的输入验证和异常处理机制

## 2. 功能模块详述

### 2.1 认证授权模块

#### 2.1.1 GitHub OAuth2 登录

**功能描述**: 用户通过 GitHub 账号进行登录认证

**API 接口**:
- `GET /auth/login/github` - 获取 GitHub OAuth2 授权 URL
- `POST /auth/callback/github` - 处理 GitHub OAuth2 回调
- `POST /auth/logout` - 用户登出
- `GET /auth/status` - 检查登录状态

**业务流程**:
1. 前端调用获取授权 URL 接口
2. 用户在 GitHub 完成授权
3. 前端获取授权码，调用回调接口
4. 系统获取 GitHub 用户信息，创建或更新本地用户
5. 生成 Sa-Token 认证令牌返回给前端

**技术实现**:
- 使用 `GitHubOAuth2Client` 处理与 GitHub API 的交互
- 通过 `AuthApplicationService` 编排认证业务流程
- 基于 Sa-Token 进行会话管理

#### 2.1.2 权限管理

**功能描述**: 基于角色的权限控制，支持管理员权限

**API 接口**:
- `GET /admin/check` - 检查当前用户是否为管理员

**权限设计**:
- **普通用户**: 可以创建、编辑自己的文章，发表评论
- **管理员**: 可以管理所有内容，包括分类、标签、用户等

### 2.2 文章管理模块

#### 2.2.1 文章 CRUD 操作

**功能描述**: 完整的文章生命周期管理

**API 接口**:
- `POST /articles` - 创建文章草稿
- `POST /articles/publish` - 直接发布文章
- `PUT /articles/{id}` - 更新文章内容
- `POST /articles/{id}/publish` - 发布文章
- `POST /articles/{id}/archive` - 归档文章
- `DELETE /articles/{id}` - 删除文章
- `GET /articles/{id}` - 获取文章详情

**文章状态管理**:
- **DRAFT**: 草稿状态，仅作者可见
- **PUBLISHED**: 已发布状态，公开可见
- **ARCHIVED**: 已归档状态，不在列表中显示但可通过直链访问

**业务规则**:
- 只有文章作者或管理员可以编辑文章
- 文章发布后会记录发布时间
- 支持文章内容的版本控制（通过更新时间追踪）

#### 2.2.2 文章查询功能

**功能描述**: 多维度的文章查询和检索

**API 接口**:
- `GET /articles` - 分页查询文章列表（支持状态、分类、标签过滤）
- `GET /articles/all` - 查询所有文章（管理员功能）
- `GET /articles/published` - 查询已发布文章
- `GET /articles/category/{categoryId}` - 按分类查询文章
- `GET /articles/tag/{tagId}` - 按标签查询文章
- `GET /articles/author/{authorId}` - 按作者查询文章
- `GET /articles/search` - 文章搜索（按标题）

**查询特性**:
- 支持分页查询，默认每页 10 条记录
- 支持多条件组合过滤
- 返回文章的完整信息，包括分类、作者、标签等关联数据
- 支持按发布时间排序

#### 2.2.3 文章标签管理

**功能描述**: 文章与标签的关联管理

**API 接口**:
- `POST /articles/{id}/tags` - 为文章添加标签
- `DELETE /articles/{id}/tags` - 移除文章标签

**业务特性**:
- 支持为文章添加多个标签
- 标签不存在时自动创建
- 支持批量添加和移除标签

### 2.3 分类管理模块

#### 2.3.1 分类 CRUD 操作

**功能描述**: 文章分类的管理功能

**API 接口**:
- `POST /categories` - 创建分类
- `PUT /categories/{id}` - 更新分类
- `DELETE /categories/{id}` - 删除分类
- `GET /categories/{id}` - 获取分类详情
- `GET /categories` - 查询分类列表
- `GET /categories/with-count` - 查询分类列表（包含文章数量）

**业务规则**:
- 分类名称必须唯一
- 删除分类前需要确保没有文章使用该分类
- 支持分类描述信息

#### 2.3.2 分类统计功能

**功能描述**: 提供分类相关的统计信息

**统计指标**:
- 每个分类下的文章数量
- 分类的使用频率统计

### 2.4 标签管理模块

#### 2.4.1 标签 CRUD 操作

**功能描述**: 标签的管理功能

**API 接口**:
- `POST /tags` - 创建标签
- `PUT /tags/{id}` - 更新标签
- `DELETE /tags/{id}` - 删除标签
- `GET /tags/{id}` - 获取标签详情
- `GET /tags` - 查询标签列表
- `GET /tags/with-count` - 查询标签列表（包含文章数量）

**业务特性**:
- 标签名称必须唯一
- 支持标签的颜色设置
- 自动统计标签使用次数

#### 2.4.2 标签云功能

**功能描述**: 基于使用频率的标签云展示

**实现特性**:
- 按标签使用次数排序
- 支持标签的热度统计

### 2.5 评论管理模块

#### 2.5.1 评论 CRUD 操作

**功能描述**: 文章评论的管理功能

**API 接口**:
- `POST /comments` - 创建评论
- `DELETE /comments/{id}` - 删除评论
- `GET /comments/article/{articleId}` - 获取文章评论列表

**业务规则**:
- 只有登录用户可以发表评论
- 评论作者和管理员可以删除评论
- 支持评论的时间排序

#### 2.5.2 评论审核功能

**功能描述**: 评论内容的审核管理

**审核机制**:
- 评论发布后立即可见（无需预审核）
- 支持后续的评论管理和删除

### 2.6 用户管理模块

#### 2.6.1 用户信息管理

**功能描述**: 用户基本信息的管理

**API 接口**:
- `GET /users/{id}` - 获取用户信息
- `GET /users` - 查询用户列表（管理员功能）

**用户信息**:
- GitHub 用户信息同步
- 用户名、头像、邮箱等基本信息
- 用户的文章统计信息

#### 2.6.2 用户权限管理

**功能描述**: 基于配置的用户权限管理

**权限配置**:
- 通过配置文件设置管理员 GitHub ID
- 支持多个管理员配置
- 动态权限检查

## 3. 数据模型

### 3.1 核心实体

#### 3.1.1 文章聚合 (ArticleAggregate)

**属性**:
- `id`: 文章唯一标识
- `content`: 文章内容（标题、正文、摘要）
- `authorId`: 作者ID
- `categoryId`: 分类ID
- `tagIds`: 标签ID集合
- `status`: 文章状态
- `publishedAt`: 发布时间
- `createdAt`: 创建时间
- `updatedAt`: 更新时间

**业务方法**:
- `createDraft()`: 创建草稿
- `publish()`: 发布文章
- `archive()`: 归档文章
- `updateContent()`: 更新内容
- `addTag()`: 添加标签
- `removeTag()`: 移除标签

#### 3.1.2 用户聚合 (UserAggregate)

**属性**:
- `id`: 用户唯一标识
- `gitHubId`: GitHub用户ID
- `username`: 用户名
- `email`: 邮箱
- `avatarUrl`: 头像URL
- `bio`: 个人简介
- `createdAt`: 创建时间
- `updatedAt`: 更新时间

#### 3.1.3 分类聚合 (CategoryAggregate)

**属性**:
- `id`: 分类唯一标识
- `name`: 分类名称
- `description`: 分类描述
- `createdAt`: 创建时间
- `updatedAt`: 更新时间

#### 3.1.4 标签聚合 (TagAggregate)

**属性**:
- `id`: 标签唯一标识
- `name`: 标签名称
- `color`: 标签颜色
- `createdAt`: 创建时间
- `updatedAt`: 更新时间

#### 3.1.5 评论聚合 (CommentAggregate)

**属性**:
- `id`: 评论唯一标识
- `articleId`: 文章ID
- `authorId`: 评论者ID
- `content`: 评论内容
- `createdAt`: 创建时间

### 3.2 值对象

#### 3.2.1 文章内容 (ArticleContent)

**属性**:
- `title`: 文章标题
- `content`: 文章正文
- `summary`: 文章摘要

#### 3.2.2 ID 值对象

- `ArticleId`: 文章ID
- `UserId`: 用户ID
- `CategoryId`: 分类ID
- `TagId`: 标签ID
- `CommentId`: 评论ID
- `AuthorId`: 作者ID
- `GitHubId`: GitHub用户ID

## 4. API 设计规范

### 4.1 RESTful 设计原则

**URL 设计**:
- 使用名词复数形式表示资源集合
- 使用 HTTP 方法表示操作类型
- 支持嵌套资源的表示

**HTTP 方法使用**:
- `GET`: 查询资源
- `POST`: 创建资源
- `PUT`: 完整更新资源
- `DELETE`: 删除资源

**状态码规范**:
- `200`: 操作成功
- `201`: 创建成功
- `400`: 请求参数错误
- `401`: 未授权
- `403`: 权限不足
- `404`: 资源不存在
- `500`: 服务器内部错误

### 4.2 统一响应格式

**成功响应**:
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    // 具体数据
  }
}
```

**错误响应**:
```json
{
  "success": false,
  "message": "错误信息",
  "data": null
}
```

### 4.3 分页查询格式

**请求参数**:
- `page`: 页码（从0开始）
- `size`: 每页大小
- 其他过滤参数

**响应格式**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "content": [
      // 数据列表
    ],
    "totalElements": 100,
    "totalPages": 10,
    "currentPage": 0,
    "pageSize": 10,
    "hasNext": true,
    "hasPrevious": false
  }
}
```

## 5. 安全特性

### 5.1 认证机制

**OAuth2 认证**:
- 支持 GitHub OAuth2 登录
- 无需存储用户密码
- 自动同步 GitHub 用户信息

**Token 管理**:
- 基于 Sa-Token 的会话管理
- 支持 Token 过期和刷新
- 提供登录状态检查

### 5.2 授权控制

**权限模型**:
- 基于用户身份的权限控制
- 支持资源级别的权限检查
- 管理员权限配置化管理

**API 权限**:
- 公开接口：文章查询、分类查询、标签查询
- 登录接口：文章创建、评论发表
- 管理员接口：用户管理、系统管理

### 5.3 数据安全

**输入验证**:
- 使用 Bean Validation 进行参数校验
- 自定义验证器处理复杂业务规则
- 统一的错误响应格式

**SQL 注入防护**:
- 使用 JPA 和 MyBatis 的参数化查询
- 避免动态 SQL 拼接

## 6. 性能特性

### 6.1 查询优化

**分页查询**:
- 所有列表查询都支持分页
- 合理的默认分页大小
- 支持总数统计

**关联查询**:
- 使用 JPA 的 EntityGraph 优化查询
- 避免 N+1 查询问题
- 批量查询关联数据

### 6.2 缓存策略

**应用层缓存**:
- 支持 Spring Cache 抽象
- 可配置的缓存过期时间
- 缓存键的合理设计

## 7. 扩展性设计

### 7.1 模块化架构

**限界上下文**:
- 文章上下文：文章、分类、标签
- 用户上下文：用户、认证
- 评论上下文：评论管理

**事件驱动**:
- 支持领域事件的发布和订阅
- 跨上下文的异步通信
- 事件处理器的解耦设计

### 7.2 配置化管理

**环境配置**:
- 支持多环境配置（dev、test、prod）
- 外部化配置管理
- 敏感信息的安全存储

**功能开关**:
- 支持功能特性的开关控制
- 运行时配置更新
- A/B 测试支持

## 8. 监控和运维

### 8.1 日志管理

**结构化日志**:
- 统一的日志格式
- 关键业务操作的日志记录
- 错误日志的详细信息

**日志级别**:
- `INFO`: 关键业务流程
- `DEBUG`: 调试信息
- `WARN`: 可恢复的错误
- `ERROR`: 致命错误

### 8.2 健康检查

**应用健康**:
- Spring Boot Actuator 集成
- 数据库连接检查
- 外部服务依赖检查

### 8.3 指标监控

**业务指标**:
- 文章创建数量
- 用户登录次数
- API 调用统计

**技术指标**:
- 响应时间统计
- 错误率监控
- 系统资源使用情况

## 9. 部署架构

### 9.1 应用部署

**容器化部署**:
- Docker 容器支持
- Kubernetes 编排
- 微服务架构就绪

**配置管理**:
- 环境变量配置
- 配置文件外部化
- 敏感信息加密存储

### 9.2 数据库部署

**关系型数据库**:
- 支持 MySQL、PostgreSQL
- 数据库连接池配置
- 读写分离支持

**数据备份**:
- 定期数据备份
- 数据恢复策略
- 数据迁移工具

## 10. 开发工具支持

### 10.1 API 文档

**Swagger 集成**:
- 自动生成 API 文档
- 在线 API 测试
- 文档与代码同步

### 10.2 开发环境

**本地开发**:
- 开发环境配置
- 热重载支持
- 调试工具集成

**测试支持**:
- 单元测试框架
- 集成测试环境
- API 测试工具

## 11. 总结

CleverOnion 博客系统是一个功能完整、架构清晰的现代化博客平台。系统采用 DDD 架构设计，具备良好的可维护性和扩展性。通过 GitHub OAuth2 认证简化了用户注册流程，提供了完整的内容管理功能，支持文章、分类、标签、评论等核心博客功能。

### 11.1 核心优势

1. **架构优势**: DDD 分层架构，代码结构清晰，易于维护
2. **技术优势**: 基于 Spring Boot 生态，技术栈成熟稳定
3. **安全优势**: OAuth2 认证，完善的权限控制
4. **扩展优势**: 模块化设计，支持功能扩展和定制

### 11.2 适用场景

- 个人博客网站
- 技术团队博客
- 企业内容管理系统
- 在线文档平台

### 11.3 未来规划

- 支持更多 OAuth2 提供商（如 Google、微信等）
- 增加文章评论的回复功能
- 实现文章的全文搜索
- 添加文章的点赞和收藏功能
- 支持文章的草稿自动保存
- 实现用户关注和订阅功能