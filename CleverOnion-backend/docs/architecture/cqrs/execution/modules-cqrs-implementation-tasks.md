# 其他模块 CQRS 实施任务清单

## 📅 创建日期：2025-10-01

---

## 📋 任务总览

| 模块         | 总任务数         | 预计用时     | 优先级 | 状态                 |
| ------------ | ---------------- | ------------ | ------ | -------------------- |
| **Category** | 25 个任务        | 1-1.5 天     | P1-高  | ✅ 已完成            |
| **Tag**      | 33 个任务 ✨     | 1.5-2 天     | P1-高  | ⬜ 待开始            |
| **Comment**  | 19 个任务 ✨     | 1 天         | P2-中  | ⬜ 待开始            |
| **User**     | 18 个任务 ✨     | 0.5-1 天     | P3-低  | ⬜ 待开始            |
| **总计**     | **95 个任务** ✨ | **4-5.5 天** | -      | **25/95 完成 (26%)** |

---

## 🎯 Category 模块任务清单（25 个任务）

### 阶段 1：准备工作（9 个任务，2-3 小时）

#### 任务 1.1：创建包结构

**描述**：创建 Category 模块的 CQRS 包结构

**具体操作**：

1. 创建 `application/category/` 包
2. 创建 `application/category/command/` 包
3. 创建 `application/category/service/` 包
4. 创建 `domain/article/event/` 包（如果不存在）

**验证标准**：

- [ ] 包结构创建完成
- [ ] 包路径符合项目规范

**预计时间**：15 分钟

**依赖**：无

**状态**：⬜ 待开始

---

#### 任务 1.2：创建 CreateCategoryCommand

**描述**：创建不可变的创建分类命令对象

**具体操作**：

1. 创建 `CreateCategoryCommand.java`
2. 定义不可变字段：`name`, `icon`
3. 实现私有构造函数
4. 实现静态工厂方法 `of()`
5. 实现参数验证逻辑
6. 只提供 getter 方法

**代码示例**：

```java
public final class CreateCategoryCommand {
    private final String name;
    private final String icon;

    private CreateCategoryCommand(String name, String icon) {
        this.name = validateName(name);
        this.icon = icon;
    }

    public static CreateCategoryCommand of(String name, String icon) {
        return new CreateCategoryCommand(name, icon);
    }

    private String validateName(String name) {
        if (name == null || name.trim().isEmpty()) {
            throw new IllegalArgumentException("分类名称不能为空");
        }
        return name.trim();
    }

    public String getName() { return name; }
    public String getIcon() { return icon; }
}
```

**验证标准**：

- [ ] 命令对象不可变（final class，final fields）
- [ ] 包含参数验证
- [ ] 编译通过

**预计时间**：20 分钟

**依赖**：任务 1.1

**状态**：⬜ 待开始

---

#### 任务 1.3：创建 UpdateCategoryCommand

**描述**：创建更新分类命令对象

**具体操作**：

1. 创建 `UpdateCategoryCommand.java`
2. 定义字段：`categoryId`, `name`, `icon`
3. 实现验证和工厂方法

**验证标准**：

- [ ] 命令对象不可变
- [ ] 包含 ID 验证
- [ ] 编译通过

**预计时间**：20 分钟

**依赖**：任务 1.1

**状态**：⬜ 待开始

---

#### 任务 1.4：创建 DeleteCategoryCommand

**描述**：创建删除分类命令对象

**具体操作**：

1. 创建 `DeleteCategoryCommand.java`
2. 定义字段：`categoryId`
3. 实现验证和工厂方法

**验证标准**：

- [ ] 命令对象不可变
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 1.1

**状态**：⬜ 待开始

---

#### 任务 1.5：创建 CategoryCreatedEvent

**描述**：创建分类创建领域事件

**具体操作**：

1. 创建 `CategoryCreatedEvent.java`
2. 定义字段：`categoryId`, `categoryName`, `occurredAt`
3. 实现构造函数和 getter

**验证标准**：

- [ ] 事件类定义完整
- [ ] 包含时间戳
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 1.1

**状态**：⬜ 待开始

---

#### 任务 1.6：创建 CategoryUpdatedEvent

**描述**：创建分类更新领域事件

**具体操作**：

1. 创建 `CategoryUpdatedEvent.java`
2. 定义字段：`categoryId`, `oldName`, `newName`, `occurredAt`

**验证标准**：

- [ ] 事件类定义完整
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 1.1

**状态**：⬜ 待开始

---

#### 任务 1.7：创建 CategoryDeletedEvent

**描述**：创建分类删除领域事件

**具体操作**：

1. 创建 `CategoryDeletedEvent.java`
2. 定义字段：`categoryId`, `categoryName`, `occurredAt`

**验证标准**：

- [ ] 事件类定义完整
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 1.1

**状态**：⬜ 待开始

---

#### 任务 1.8：创建命令对象单元测试

**描述**：为所有命令对象创建单元测试

**具体操作**：

1. 创建 `CreateCategoryCommandTest.java`
2. 创建 `UpdateCategoryCommandTest.java`
3. 创建 `DeleteCategoryCommandTest.java`
4. 测试参数验证逻辑
5. 测试不可变性

**验证标准**：

- [ ] 每个命令对象都有测试
- [ ] 测试覆盖率 > 90%
- [ ] 所有测试通过

**预计时间**：30 分钟

**依赖**：任务 1.2, 1.3, 1.4

**状态**：⬜ 待开始

---

#### 任务 1.9：阶段 1 验收

**描述**：验证阶段 1 所有任务完成

**具体操作**：

1. 检查所有文件编译通过
2. 检查所有测试通过
3. 检查代码符合规范

**验证标准**：

- [ ] 所有命令对象创建完成
- [ ] 所有事件类创建完成
- [ ] 测试覆盖率 > 90%
- [ ] 无编译错误

**预计时间**：10 分钟

**依赖**：任务 1.1-1.8

**状态**：⬜ 待开始

---

### 阶段 2：命令服务实施（8 个任务，3-4 小时）

#### 任务 2.1：创建 CategoryCommandService

**描述**：创建分类命令服务类框架

**具体操作**：

1. 创建 `CategoryCommandService.java`
2. 添加 `@Service` 和 `@Transactional` 注解
3. 注入依赖：`CategoryRepository`, `ArticleRepository`, `DomainEventPublisher`
4. 添加 Logger

**验证标准**：

- [ ] 服务类创建完成
- [ ] 依赖注入正确
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 1.9

**状态**：⬜ 待开始

---

#### 任务 2.2：实现 createCategory 方法

**描述**：实现创建分类命令方法

**具体操作**：

1. 实现方法签名：`createCategory(CreateCategoryCommand command)`
2. 添加 `@CacheEvict` 注解
3. 实现业务逻辑：检查名称、创建聚合、保存、发布事件
4. 添加日志

**验证标准**：

- [ ] 方法实现完整
- [ ] 缓存失效配置正确
- [ ] 事件发布正确
- [ ] 编译通过

**预计时间**：30 分钟

**依赖**：任务 2.1

**状态**：⬜ 待开始

---

#### 任务 2.3：实现 updateCategory 方法

**描述**：实现更新分类命令方法

**具体操作**：

1. 实现方法签名
2. 添加缓存失效注解
3. 实现更新逻辑
4. 发布更新事件

**验证标准**：

- [ ] 方法实现完整
- [ ] 事件发布正确

**预计时间**：30 分钟

**依赖**：任务 2.1

**状态**：⬜ 待开始

---

#### 任务 2.4：实现 deleteCategory 方法

**描述**：实现删除分类命令方法

**具体操作**：

1. 实现方法签名
2. 检查分类下是否有文章
3. 实现删除逻辑
4. 发布删除事件

**验证标准**：

- [ ] 方法实现完整
- [ ] 业务规则验证正确

**预计时间**：30 分钟

**依赖**：任务 2.1

**状态**：⬜ 待开始

---

#### 任务 2.5：实现 createCategories 批量方法

**描述**：实现批量创建分类方法

**具体操作**：

1. 实现批量创建逻辑
2. 添加缓存失效
3. 批量发布事件

**验证标准**：

- [ ] 批量操作正确
- [ ] 事务处理正确

**预计时间**：30 分钟

**依赖**：任务 2.2

**状态**：⬜ 待开始

---

#### 任务 2.6：创建 CategoryCommandServiceTest

**描述**：创建命令服务单元测试

**具体操作**：

1. 创建测试类
2. Mock 依赖
3. 测试每个命令方法
4. 测试异常情况

**验证标准**：

- [ ] 测试覆盖所有方法
- [ ] 测试覆盖率 > 85%
- [ ] 所有测试通过

**预计时间**：60 分钟

**依赖**：任务 2.2-2.5

**状态**：⬜ 待开始

---

#### 任务 2.7：测试事件发布

**描述**：验证领域事件发布正确

**具体操作**：

1. 编写事件监听器测试
2. 验证事件内容正确
3. 验证事件顺序

**验证标准**：

- [ ] 事件发布验证通过
- [ ] 事件内容正确

**预计时间**：20 分钟

**依赖**：任务 2.6

**状态**：⬜ 待开始

---

#### 任务 2.8：阶段 2 验收

**描述**：验证阶段 2 所有任务完成

**验证标准**：

- [ ] 所有命令方法实现完成
- [ ] 事件发布正确
- [ ] 缓存失效正确
- [ ] 测试覆盖率 > 85%
- [ ] 所有测试通过

**预计时间**：10 分钟

**依赖**：任务 2.1-2.7

**状态**：⬜ 待开始

---

### 阶段 3：查询服务实施（6 个任务，3-4 小时）

#### 任务 3.1：创建 CategoryQueryService

**描述**：创建分类查询服务类框架

**具体操作**：

1. 创建服务类
2. 添加 `@Service` 和 `@Transactional(readOnly = true)` 注解
3. 注入依赖

**验证标准**：

- [ ] 服务类创建完成
- [ ] 只读事务配置正确

**预计时间**：15 分钟

**依赖**：任务 2.8

**状态**：⬜ 待开始

---

#### 任务 3.2：实现基础查询方法（5 个）

**描述**：实现基础查询方法并配置缓存

**方法列表**：

- `findById(CategoryId id)`
- `findByIds(Set<CategoryId> ids)`
- `findByName(String name)`
- `findAll()`
- `findWithPagination(int page, int size)`

**具体操作**：

1. 实现每个查询方法
2. 添加 `@Cacheable` 注解
3. 配置缓存 key 和 TTL

**验证标准**：

- [ ] 所有方法实现完成
- [ ] 缓存配置正确
- [ ] 参数验证完整

**预计时间**：60 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.3：实现排序查询方法（2 个）

**描述**：实现排序查询方法

**方法列表**：

- `findAllOrderByName(boolean ascending)`
- `findAllOrderByCreatedAt(boolean ascending)`

**验证标准**：

- [ ] 排序逻辑正确
- [ ] 缓存配置正确

**预计时间**：20 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.4：实现搜索和统计方法（5 个）

**描述**：实现搜索和统计方法

**方法列表**：

- `searchByName(String keyword)`
- `countAll()`
- `existsById(CategoryId id)`
- `existsByName(String name)`
- `findRecentlyCreated(int limit)`

**验证标准**：

- [ ] 搜索功能正确
- [ ] 统计准确
- [ ] 缓存 TTL 配置合理（统计类 30 分钟）

**预计时间**：40 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.5：实现业务查询方法（2 个）

**描述**：实现业务相关查询方法

**方法列表**：

- `getCategoryUsageCount(CategoryId id)`
- `findWithArticleCount(int page, int size)`

**验证标准**：

- [ ] 业务逻辑正确
- [ ] 关联查询正确

**预计时间**：30 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.6：创建 CategoryQueryServiceTest

**描述**：创建查询服务单元测试

**具体操作**：

1. 创建测试类
2. 测试所有查询方法
3. 验证缓存配置

**验证标准**：

- [ ] 测试覆盖所有方法
- [ ] 测试覆盖率 > 85%
- [ ] 缓存测试通过

**预计时间**：60 分钟

**依赖**：任务 3.2-3.5

**状态**：⬜ 待开始

---

### 阶段 4：控制器集成（1 个任务，1-2 小时）

#### 任务 4.1：更新 CategoryController

**描述**：更新控制器以使用新的 Command 和 Query 服务

**具体操作**：

1. 注入 `CategoryCommandService`
2. 注入 `CategoryQueryService`
3. 更新所有 API 方法
4. 保留旧服务作为备份（标记 @Deprecated）
5. 编写集成测试

**API 方法列表**：

- POST /categories - 创建分类
- PUT /categories/{id} - 更新分类
- DELETE /categories/{id} - 删除分类
- GET /categories/{id} - 查询分类
- GET /categories - 查询列表

**验证标准**：

- [ ] 所有 API 功能正常
- [ ] 集成测试通过
- [ ] API 响应正确

**预计时间**：60-120 分钟

**依赖**：任务 2.8, 3.6

**状态**：⬜ 待开始

---

### 阶段 5：清理和文档（1 个任务，1 小时）

#### 任务 5.1：清理旧代码和更新文档

**描述**：清理旧代码，更新相关文档

**具体操作**：

1. 删除旧的 CategoryApplicationService
2. 删除相关的旧测试
3. 更新 API 文档
4. 更新架构文档
5. 代码 Review

**验证标准**：

- [ ] 旧代码已删除
- [ ] 无编译错误
- [ ] 所有测试通过
- [ ] 文档更新完成

**预计时间**：60 分钟

**依赖**：任务 4.1

**状态**：⬜ 待开始

---

## 🏷️ Tag 模块任务清单（33 个任务）✨ **已修正和详细展开**

### 阶段 1：准备工作（13 个任务，3.5-4.5 小时）

#### 任务 1.1：创建包结构

**预计时间**：15 分钟 | **依赖**：无 | **状态**：⬜ 待开始

---

#### 任务 1.2-1.9：创建命令对象（8 个）

- `CreateTagCommand`
- `UpdateTagCommand`
- `DeleteTagCommand`
- `CreateTagsCommand`
- `SaveTagsCommand`
- `DeleteTagsCommand`
- `CleanupUnusedTagsCommand`
- `FindOrCreateTagsCommand` ✨ **补充**

**预计时间**：140 分钟 | **依赖**：1.1 | **状态**：⬜ 待开始

---

#### 任务 1.10-1.11：创建领域事件（2 个）

- `TagCreatedEvent`
- `TagUpdatedEvent`
- （TagDeletedEvent 已存在，复用）

**预计时间**：30 分钟 | **依赖**：1.1 | **状态**：⬜ 待开始

---

#### 任务 1.12：创建命令对象单元测试

**预计时间**：70 分钟 | **依赖**：1.2-1.11 | **状态**：⬜ 待开始

---

#### 任务 1.13：阶段 1 验收

**预计时间**：10 分钟 | **依赖**：1.1-1.12 | **状态**：⬜ 待开始

---

### 阶段 2：命令服务实施（10 个任务，4-5 小时）

#### 任务 2.1：创建 TagCommandService 框架

**预计时间**：15 分钟 | **依赖**：1.12 | **状态**：⬜ 待开始

---

#### 任务 2.2-2.9：实现命令方法（8 个）

- `createTag`
- `updateTagName`
- `deleteTag`
- `createTags`
- `saveTags`
- `deleteTags`
- `cleanupUnusedTags`
- `findOrCreateByNames`

**预计时间**：180 分钟 | **依赖**：2.1 | **状态**：⬜ 待开始

---

#### 任务 2.10：创建 TagCommandServiceTest

**预计时间**：90 分钟 | **依赖**：2.2-2.9 | **状态**：⬜ 待开始

---

### 阶段 3：查询服务实施（8 个任务，4-5 小时）✨ **已详细展开**

#### 任务 3.1：创建 TagQueryService 框架

**描述**：创建标签查询服务类框架

**具体操作**：

1. 创建 `TagQueryService.java`
2. 添加 `@Service` 和 `@Transactional(readOnly = true)` 注解
3. 注入依赖：`TagRepository`, `ArticleRepository`
4. 添加 Logger

**验证标准**：

- [ ] 服务类创建完成
- [ ] 只读事务配置正确
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 2.10

**状态**：⬜ 待开始

---

#### 任务 3.2：实现基础查询方法（6 个）

**描述**：实现基础查询方法并配置缓存

**方法列表**：

- `findById(TagId id)`
- `findByIds(Set<TagId> ids)`
- `findByName(String name)`
- `findByNames(Set<String> names)`
- `findAll()`
- `findWithPagination(int page, int size)`

**具体操作**：

1. 实现每个查询方法
2. 添加 `@Cacheable` 注解
3. 配置缓存 key 和 TTL（15 分钟）

**验证标准**：

- [ ] 所有方法实现完成
- [ ] 缓存配置正确
- [ ] 参数验证完整

**预计时间**：60 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.3：实现排序查询方法（2 个）

**描述**：实现排序查询方法

**方法列表**：

- `findAllOrderByName(boolean ascending)`
- `findAllOrderByCreatedAt(boolean ascending)`

**验证标准**：

- [ ] 排序逻辑正确
- [ ] 缓存配置正确（5 分钟）

**预计时间**：20 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.4：实现搜索查询方法（2 个）

**描述**：实现搜索功能

**方法列表**：

- `searchByName(String keyword)`
- `searchByNamePrefix(String prefix)`

**验证标准**：

- [ ] 搜索功能正确
- [ ] 缓存配置正确（5 分钟）

**预计时间**：25 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.5：实现统计查询方法（3 个）

**描述**：实现统计方法

**方法列表**：

- `countAll()`
- `existsById(TagId id)`
- `existsByName(String name)`

**验证标准**：

- [ ] 统计准确
- [ ] 缓存 TTL 配置合理（30 分钟）

**预计时间**：25 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.6：实现特殊查询方法（4 个）

**描述**：实现特殊业务查询

**方法列表**：

- `findRecentlyCreated(int limit)`
- `findPopularTags(int limit)`
- `findUnusedTags()`
- `findWithArticleCount(int page, int size)`

**验证标准**：

- [ ] 业务逻辑正确
- [ ] 缓存配置正确（5-10 分钟）

**预计时间**：35 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.7：实现业务查询方法（4 个）

**描述**：实现业务相关查询

**方法列表**：

- `getTagUsageCount(TagId id)`
- `findShortTags(int maxLength)`
- `filterByKeyword(String keyword)`
- `filterByPrefix(String prefix)`

**验证标准**：

- [ ] 业务逻辑正确
- [ ] 过滤功能正确

**预计时间**：35 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.8：创建 TagQueryServiceTest

**描述**：创建查询服务单元测试

**具体操作**：

1. 创建测试类
2. 测试所有 21 个查询方法
3. 验证缓存配置
4. 测试边界条件

**验证标准**：

- [ ] 测试覆盖所有方法
- [ ] 测试覆盖率 > 85%
- [ ] 缓存测试通过

**预计时间**：90 分钟

**依赖**：任务 3.2-3.7

**状态**：⬜ 待开始

---

### 阶段 4：控制器集成（1 个任务）

#### 任务 4.1：更新 TagController

**预计时间**：60-120 分钟 | **状态**：⬜ 待开始

---

### 阶段 5：清理和文档（1 个任务）

#### 任务 5.1：清理和文档更新

**预计时间**：60 分钟 | **状态**：⬜ 待开始

---

## 💬 Comment 模块任务清单（19 个任务）✨ **已详细展开**

### 阶段 1：准备工作（3 个任务，1-2 小时）

#### 任务 1.1：创建领域事件

**描述**：创建评论相关领域事件（命令对象已存在）

**事件列表**：

- `CommentCreatedEvent`
- `CommentDeletedEvent`

**预计时间**：30 分钟 | **状态**：⬜ 待开始

---

#### 任务 1.2：创建事件单元测试

**预计时间**：20 分钟 | **状态**：⬜ 待开始

---

#### 任务 1.3：阶段 1 验收

**预计时间**：10 分钟 | **状态**：⬜ 待开始

---

### 阶段 2：命令服务实施（6 个任务，2-3 小时）

#### 任务 2.1：创建 CommentCommandService

**预计时间**：15 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.2：实现 createComment 方法

**描述**：迁移并优化创建评论方法

**具体操作**：

1. 复用现有 `CreateCommentCommand`
2. 添加缓存失效
3. 集成事件发布
4. 处理回复评论逻辑

**预计时间**：40 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.3：实现 deleteComment 方法

**描述**：迁移并优化删除评论方法

**具体操作**：

1. 复用现有 `DeleteCommentCommand`
2. 添加缓存失效
3. 递归删除子评论
4. 发布删除事件

**预计时间**：40 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.4：创建 CommentCommandServiceTest

**预计时间**：60 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.5：测试事件发布

**预计时间**：20 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.6：阶段 2 验收

**预计时间**：10 分钟 | **状态**：⬜ 待开始

---

### 阶段 3：查询服务实施（7 个任务，3-4 小时）✨ **已详细展开**

#### 任务 3.1：创建 CommentQueryService 框架

**描述**：创建评论查询服务类框架

**具体操作**：

1. 创建 `CommentQueryService.java`
2. 添加 `@Service` 和 `@Transactional(readOnly = true)` 注解
3. 注入依赖：`CommentRepository`
4. 添加 Logger

**验证标准**：

- [ ] 服务类创建完成
- [ ] 只读事务配置正确
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 2.6

**状态**：⬜ 待开始

---

#### 任务 3.2：实现基础查询方法（1 个）

**描述**：实现基础 ID 查询

**方法列表**：

- `findById(CommentId id)`

**验证标准**：

- [ ] 方法实现完成
- [ ] 缓存配置正确（10 分钟）

**预计时间**：15 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.3：实现文章评论查询方法（2 个）

**描述**：实现根据文章 ID 查询评论

**方法列表**：

- `findByArticleId(ArticleId articleId)`
- `findTopLevelByArticleId(ArticleId articleId, int page, int size)` - 分页版本

**验证标准**：

- [ ] 分页逻辑正确
- [ ] 缓存配置正确（5 分钟）

**预计时间**：30 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.4：实现回复查询方法（2 个）

**描述**：实现查询评论回复

**方法列表**：

- `findRepliesByParentId(CommentId parentId)`
- `findRepliesByParentIdWithPage(CommentId parentId, int page, int size)`

**验证标准**：

- [ ] 递归查询正确
- [ ] 缓存配置正确（5 分钟）

**预计时间**：35 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.5：实现统计查询方法（3 个）

**描述**：实现评论统计功能

**方法列表**：

- `countByArticleId(ArticleId articleId)`
- `countTopLevelByArticleId(ArticleId articleId)`
- `countRepliesByParentId(CommentId parentId)`

**验证标准**：

- [ ] 统计准确
- [ ] 缓存 TTL 配置合理（15 分钟）

**预计时间**：30 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.6：优化查询性能

**描述**：优化评论树结构查询

**具体操作**：

1. 优化 N+1 查询问题
2. 配置 JOIN FETCH
3. 批量加载优化

**验证标准**：

- [ ] 查询性能优化
- [ ] 无 N+1 问题

**预计时间**：20 分钟

**依赖**：任务 3.2-3.5

**状态**：⬜ 待开始

---

#### 任务 3.7：创建 CommentQueryServiceTest

**描述**：创建查询服务单元测试

**具体操作**：

1. 创建测试类
2. 测试所有 9 个查询方法
3. 测试评论树结构查询
4. 验证缓存配置

**验证标准**：

- [ ] 测试覆盖所有方法
- [ ] 测试覆盖率 > 85%
- [ ] 缓存测试通过

**预计时间**：60 分钟

**依赖**：任务 3.2-3.6

**状态**：⬜ 待开始

---

### 阶段 4-5：集成和清理（3 个任务）

#### 任务 4.1：更新 CommentController

**预计时间**：60 分钟 | **状态**：⬜ 待开始

---

#### 任务 5.1：清理和文档

**预计时间**：30 分钟 | **状态**：⬜ 待开始

---

## 👤 User 模块任务清单（18 个任务）✨ **已详细展开**

### 阶段 1：准备工作（5 个任务，1-1.5 小时）

#### 任务 1.1：创建包结构

**预计时间**：15 分钟 | **状态**：⬜ 待开始

---

#### 任务 1.2：创建 SyncGitHubUserCommand

**描述**：创建 GitHub 用户同步命令对象

**预计时间**：30 分钟 | **状态**：⬜ 待开始

---

#### 任务 1.3-1.4：创建领域事件（可选）

- `UserCreatedEvent`（可选）
- `UserUpdatedEvent`（可选）

**预计时间**：20 分钟 | **状态**：⬜ 待开始

---

#### 任务 1.5：创建单元测试

**预计时间**：20 分钟 | **状态**：⬜ 待开始

---

### 阶段 2：命令服务实施（4 个任务，1.5-2 小时）

#### 任务 2.1：创建 UserCommandService

**预计时间**：15 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.2：实现 syncUserFromGitHub 方法

**描述**：实现 GitHub 用户同步方法

**具体操作**：

1. 实现创建或更新逻辑
2. 添加缓存失效
3. 可选：发布事件

**预计时间**：40 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.3：创建 UserCommandServiceTest

**预计时间**：40 分钟 | **状态**：⬜ 待开始

---

#### 任务 2.4：阶段 2 验收

**预计时间**：10 分钟 | **状态**：⬜ 待开始

---

### 阶段 3：查询服务实施（7 个任务，2-3 小时）✨ **已详细展开**

#### 任务 3.1：创建 UserQueryService 框架

**描述**：创建用户查询服务类框架

**具体操作**：

1. 创建 `UserQueryService.java`
2. 添加 `@Service` 和 `@Transactional(readOnly = true)` 注解
3. 注入依赖：`UserRepository`
4. 添加 Logger

**验证标准**：

- [ ] 服务类创建完成
- [ ] 只读事务配置正确
- [ ] 编译通过

**预计时间**：15 分钟

**依赖**：任务 2.4

**状态**：⬜ 待开始

---

#### 任务 3.2：实现基础查询方法（4 个）

**描述**：实现基础 ID 和名称查询

**方法列表**：

- `findById(UserId id)`
- `findByIds(Set<UserId> ids)`
- `findByGitHubId(GitHubId gitHubId)`
- `findByUsername(String username)`

**具体操作**：

1. 实现每个查询方法
2. 添加 `@Cacheable` 注解
3. 配置缓存 key 和 TTL（30 分钟）

**验证标准**：

- [ ] 所有方法实现完成
- [ ] 缓存配置正确
- [ ] 参数验证完整

**预计时间**：40 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.3：实现存在性检查方法（2 个）

**描述**：实现存在性验证

**方法列表**：

- `existsByGitHubId(GitHubId gitHubId)`
- `existsByUsername(String username)`

**验证标准**：

- [ ] 检查逻辑正确
- [ ] 缓存 TTL 配置合理（60 分钟）

**预计时间**：20 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.4：实现分页和统计方法（2 个）

**描述**：实现分页查询和统计

**方法列表**：

- `findWithPagination(int page, int size)`
- `countAll()`

**验证标准**：

- [ ] 分页逻辑正确
- [ ] 统计准确
- [ ] 缓存配置正确（10-60 分钟）

**预计时间**：30 分钟

**依赖**：任务 3.1

**状态**：⬜ 待开始

---

#### 任务 3.5：创建 UserQueryServiceTest

**描述**：创建查询服务单元测试

**具体操作**：

1. 创建测试类
2. 测试所有 8 个查询方法
3. 验证缓存配置
4. 测试 GitHub 同步场景

**验证标准**：

- [ ] 测试覆盖所有方法
- [ ] 测试覆盖率 > 85%
- [ ] 缓存测试通过

**预计时间**：60 分钟

**依赖**：任务 3.2-3.4

**状态**：⬜ 待开始

---

#### 任务 3.6：验证 UserListResponse 转换

**描述**：验证分页响应对象转换正确

**具体操作**：

1. 测试 DTO 转换逻辑
2. 验证分页信息正确
3. 验证响应格式

**验证标准**：

- [ ] DTO 转换正确
- [ ] 分页信息完整

**预计时间**：15 分钟

**依赖**：任务 3.4

**状态**：⬜ 待开始

---

#### 任务 3.7：阶段 3 验收

**描述**：验证查询服务阶段完成

**验证标准**：

- [ ] 所有查询方法实现完成
- [ ] 缓存配置正确
- [ ] 测试覆盖率 > 85%
- [ ] 所有测试通过

**预计时间**：10 分钟

**依赖**：任务 3.1-3.6

**状态**：⬜ 待开始

---

### 阶段 4-5：集成和清理（2 个任务）

#### 任务 4.1：更新控制器（如果需要）

**预计时间**：30 分钟 | **状态**：⬜ 待开始

---

#### 任务 5.1：清理和文档

**预计时间**：30 分钟 | **状态**：⬜ 待开始

---

## 📊 任务统计

### 按模块统计

| 模块     | 准备      | 命令   | 查询      | 集成  | 清理  | 总计      |
| -------- | --------- | ------ | --------- | ----- | ----- | --------- |
| Category | 9         | 8      | 6         | 1     | 1     | 25 ✅     |
| Tag      | 13 ✨     | 10     | 8 ✨      | 1     | 1     | 33 ✨     |
| Comment  | 3         | 6      | 7 ✨      | 1     | 2     | 19 ✨     |
| User     | 5         | 4      | 7 ✨      | 1     | 1     | 18 ✨     |
| **总计** | **30** ✨ | **28** | **28** ✨ | **4** | **5** | **95** ✨ |

### 按阶段统计

| 阶段               | 任务数    | 预计用时       | 占比     |
| ------------------ | --------- | -------------- | -------- |
| 阶段 1：准备工作   | 30 ✨     | 7.5-10 小时    | 32%      |
| 阶段 2：命令服务   | 28        | 10-13 小时     | 29%      |
| 阶段 3：查询服务   | 28 ✨     | 13-17 小时     | 30%      |
| 阶段 4：控制器集成 | 4         | 3.5-5 小时     | 5%       |
| 阶段 5：清理文档   | 5         | 3-4 小时       | 5%       |
| **总计**           | **95** ✨ | **37-49 小时** | **100%** |

---

## 🎯 里程碑

### 里程碑 1：Category 模块完成

**目标日期**：Day 1  
**完成标准**：

- [ ] 所有 25 个任务完成
- [ ] 测试覆盖率 > 85%
- [ ] 所有 API 正常工作

---

### 里程碑 2：Tag 模块完成

**目标日期**：Day 3  
**完成标准**：

- [ ] 所有 30 个任务完成
- [ ] 测试覆盖率 > 85%
- [ ] 复杂查询正常工作

---

### 里程碑 3：Comment 模块完成

**目标日期**：Day 4  
**完成标准**：

- [ ] 所有 18 个任务完成
- [ ] 递归删除功能正常
- [ ] 评论树结构查询正确

---

### 里程碑 4：User 模块完成

**目标日期**：Day 4.5  
**完成标准**：

- [ ] 所有 16 个任务完成
- [ ] GitHub 同步功能正常
- [ ] 缓存优化生效

---

### 里程碑 5：所有模块 CQRS 完成

**目标日期**：Day 5  
**完成标准**：

- [ ] 所有 89 个任务完成
- [ ] 所有模块测试通过
- [ ] 性能测试达标
- [ ] 文档更新完成

---

## 📝 使用说明

### 如何使用本清单

1. **开始前**：

   - 阅读完整的任务清单
   - 理解任务依赖关系
   - 准备开发环境

2. **执行中**：

   - 按顺序完成任务
   - 完成后勾选复选框
   - 更新进度跟踪表

3. **验证**：
   - 每个任务完成后验证
   - 每个阶段完成后验收
   - 里程碑达成后庆祝 🎉

### 任务优先级

**P1-高优先级**（先做）：

- Category 模块（Day 1）
- Tag 模块（Day 2-3）

**P2-中优先级**（其次）：

- Comment 模块（Day 4）

**P3-低优先级**（最后）：

- User 模块（Day 4.5-5）

---

**文档版本**：v1.0  
**创建日期**：2025-10-01  
**最后更新**：2025-10-01  
**状态**：待开始 ⏳

**相关文档**：

- [设计文档](../design/modules-cqrs-implementation-guide.md)
- [进度跟踪表](./modules-cqrs-progress-tracker.md)
- [Article 任务清单](./cqrs-implementation-tasks.md)（参考）
